<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>coreJS-app</title>
    <meta name="description" content="coreJS App Documentation" />
    <meta name="keywords" content="corejs-app" />
    <meta name="keyword" content="corejs-app" />
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    <meta property="og:site_name" content=""/>
    <meta property="og:url" content=""/>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"coreJS-app","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"coreJS-app","description":"coreJS App Documentation","keyword":"corejs-app"}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">coreJS-app</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="app">
            <span class="title">
                <a href="app.html">app</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.root"><a href="app.html#root">root</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.jst">
            <span class="title">
                <a href="app.jst.html">app.jst</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.oauth">
            <span class="title">
                <a href="app.oauth.html">app.oauth</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.oauth.URL_ENCODED"><a href="app.oauth.html#URL_ENCODED">URL_ENCODED</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.oauth.authorization"><a href="app.oauth.html#authorization">authorization</a></li>
            
                <li data-name="app.oauth.token"><a href="app.oauth.html#token">token</a></li>
            
                <li data-name="app.oauth.user"><a href="app.oauth.html#user">user</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.services">
            <span class="title">
                <a href="app.services.html">app.services</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.services.arrayScopesToString"><a href="app.services.html#arrayScopesToString">arrayScopesToString</a></li>
            
                <li data-name="app.services.isCrossDomain"><a href="app.services.html#isCrossDomain">isCrossDomain</a></li>
            
                <li data-name="app.services.request"><a href="app.services.html#request">request</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.services.method">
            <span class="title">
                <a href="app.services.method.html">app.services.method</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.services.method.DELETE"><a href="app.services.method.html#DELETE">DELETE</a></li>
            
                <li data-name="app.services.method.GET"><a href="app.services.method.html#GET">GET</a></li>
            
                <li data-name="app.services.method.HEAD"><a href="app.services.method.html#HEAD">HEAD</a></li>
            
                <li data-name="app.services.method.OPTIONS"><a href="app.services.method.html#OPTIONS">OPTIONS</a></li>
            
                <li data-name="app.services.method.PATCH"><a href="app.services.method.html#PATCH">PATCH</a></li>
            
                <li data-name="app.services.method.POST"><a href="app.services.method.html#POST">POST</a></li>
            
                <li data-name="app.services.method.PUT"><a href="app.services.method.html#PUT">PUT</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.session">
            <span class="title">
                <a href="app.session.html">app.session</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.session.STATUS_SELECTOR"><a href="app.session.html#STATUS_SELECTOR">STATUS_SELECTOR</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.session.add"><a href="app.session.html#add">add</a></li>
            
                <li data-name="app.session.destroy"><a href="app.session.html#destroy">destroy</a></li>
            
                <li data-name="app.session.exist"><a href="app.session.html#exist">exist</a></li>
            
                <li data-name="app.session.gatekeeper"><a href="app.session.html#gatekeeper">gatekeeper</a></li>
            
                <li data-name="app.session.get"><a href="app.session.html#get">get</a></li>
            
                <li data-name="app.session.isPersistent"><a href="app.session.html#isPersistent">isPersistent</a></li>
            
                <li data-name="app.session.logged"><a href="app.session.html#logged">logged</a></li>
            
                <li data-name="app.session.removeStatus"><a href="app.session.html#removeStatus">removeStatus</a></li>
            
                <li data-name="app.session.setPersistent"><a href="app.session.html#setPersistent">setPersistent</a></li>
            
                <li data-name="app.session.setStatus"><a href="app.session.html#setStatus">setStatus</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.user">
            <span class="title">
                <a href="app.user.html">app.user</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="app.user.login"><a href="app.user.html#login">login</a></li>
            
                <li data-name="app.user.loginToken"><a href="app.user.html#loginToken">loginToken</a></li>
            
                <li data-name="app.user.logout"><a href="app.user.html#logout">logout</a></li>
            
                <li data-name="app.user.register"><a href="app.user.html#register">register</a></li>
            
                <li data-name="app.user.registerIAM"><a href="app.user.html#registerIAM">registerIAM</a></li>
            
                <li data-name="app.user.remove"><a href="app.user.html#remove">remove</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="app.user.statusCode">
            <span class="title">
                <a href="app.user.statusCode.html">app.user.statusCode</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="app.user.statusCode.USER_EXIST"><a href="app.user.statusCode.html#USER_EXIST">USER_EXIST</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="oauth.js.html">Source: engine/silkroad/oauth.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source"><code>'use strict';
/* global define */
define([
    'corejs/app',
    'jquery',
    'corejs/engine/silkroad/services'
], function(app, $, services) {

    /** 
     * A module to make oauth requests.
     * @exports oauth
     * @namespace
     * @memberof app
     */
    var oauth = {

        /**
         * Default encoding
         * @type {String}
         * @default application/x-www-form-urlencoded; charset=UTF-8
         */
        URL_ENCODED: 'application/x-www-form-urlencoded; charset=UTF-8'
    };

    // TODO: refactor with validation module
    var checkProp = function(dict, keys, excep) {
        var error = excep ? excep : 'Error validating arguments';
        if (!dict) {
            throw error;
        }
        for (var i in keys) {
            if (!(keys[i] in dict)) {
                throw error;
            }
        }
    };

    var validateResponseType = function(responseType) {
        if (responseType !== 'code') {
            throw 'Only "code" response type allowed';
        }
    };

    var validateGrantType = function(grantType) {
        if (grantType !== 'authorization_code') {
            throw 'Only "authorization_code" grant type is allowed';
        }
    };

    var trasformParams = function(clientParams) {

        for (var key in clientParams) {
            clientParams[toUnderscore(key)] = clientParams[key];
            delete clientParams[key];
        }
        return clientParams;

    };

    var toUnderscore = function(string) {
        return string.replace(/([A-Z])/g, function($1) {
            return '_' + $1.toLowerCase();
        });
    };

    /**
     * Returns
     * @param  {Object} clientParams
     * @param  {String} clientParams.clientId
     * @param  {String} clientParams.responseType
     * @param  {String} clientParams.redirectUri
     * @param  {String} clientParams.responseType
     * @return {AuthorizationBuilder} Oauth builder
     */
    oauth.authorization = function(clientParams) {
        checkProp(clientParams, ['clientId', 'responseType', 'redirectUri'], 'Invalid client parameters');
        validateResponseType(clientParams.responseType);
        var params = {
            url: app.common.get('oauthEndpoint') + 'oauth/authorize',
            contentType: oauth.URL_ENCODED,
            data: trasformParams(clientParams)
        };
        return new AuthorizationBuilder(params);
    };

    function AuthorizationBuilder(params) {
        this.params = params;
    }

    AuthorizationBuilder.prototype.dialog = function() {
        this.params.method = services.method.GET;
        this.params.query = $.param(this.params.data);
        delete this.params.data;
        this.params.dataType = 'text';
        return services.request(this.params);
    };

    AuthorizationBuilder.prototype.login = function(username, password) {
        this.params.method = services.method.POST;
        this.params.data.username = username;
        this.params.data.password = password;
        return services.request(this.params);
    };

    /**
     * Returns
     * @param  {Object} clientParams
     * @param  {String} clientParams.clientId
     * @param  {String} clientParams.clientSecret
     * @param  {String} clientParams.grantType
     * @return {TokenBuilder} Oauth builder
     */
    oauth.token = function(clientParams) {
        checkProp(clientParams, ['clientId', 'clientSecret', 'grantType'], 'Invalid client parameters');
        validateGrantType(clientParams.grantType);
        var params = {
            method: services.method.POST,
            url: app.common.get('oauthEndpoint') + 'oauth/token',
            contentType: oauth.URL_ENCODED,
            data: trasformParams(clientParams)
        };
        return new TokenBuilder(params);
    };

    function TokenBuilder(params) {
        this.params = params;
    }

    TokenBuilder.prototype.get = function(code) {
        this.params.data.code = code;
        return services.request(this.params);
    };

    /**
     * Returns
     * @param  {Object} clientParams
     * @param  {String} clientParams.clientId
     * @param  {String} clientParams.clientSecret
     * @param  {String} accessToken
     * @return {UserBuilder} Oauth builder
     */
    oauth.user = function(clientParams, accessToken) {
        var params = {
            url: app.common.get('oauthEndpoint') + 'user'
        };
        if (accessToken) {
            params.headers = {
                Authorization: 'Bearer ' + accessToken,
                Accept: 'application/json'
            };
            return new UserMeBuilder(params);
        } else if(clientParams) {
            return new UserBuilder(params, clientParams.clientId, clientParams.clientSecret);
        } else {
            throw new Error('Invalid user parameters');
        }
    };

    function UserMeBuilder(params) {
        this.params = params;
    }

    function UserBuilder(params, clientId, clientSecret) {
        this.params = params;
        this.clientSecret = clientSecret;
        this.clientId = clientId;
    }

    UserBuilder.prototype.create = function(user) {
        this.params.method = services.method.POST;
        this.params.headers = {
            Authorization: 'Basic ' + btoa(this.clientId + ':' + this.clientSecret)
        };
        // server returns no responseText
        this.params.dataType = 'text';
        this.params.data = user;
        return services.requestXHR(this.params).then(function(res) {
            return services.extractLocationId(res);
        });
    };

    UserMeBuilder.prototype.getMe = function() {
        this.addMeEndpoint();
        this.params.method = services.method.GET;
        return services.request(this.params);
    };

    UserMeBuilder.prototype.updateMe = function(modification) {
        this.addMeEndpoint();
        this.params.method = services.method.PUT;
        this.params.data = modification;
        return services.request(this.params);
    };

    UserMeBuilder.prototype.deleteMe = function() {
        this.addMeEndpoint();
        this.params.method = services.method.DELETE;
        return services.request(this.params);
    };

    UserMeBuilder.prototype.sendValidateEmail = function() {
        this.addMeEndpoint();
        this.addValidateEndpoint();
        this.params.method = services.method.GET;
        return services.request(this.params);
    };

    UserMeBuilder.prototype.validateEmail = function() {
        this.addMeEndpoint();
        this.addValidateEndpoint();
        this.params.method = services.method.POST;
        return services.request(this.params);
    };

    UserMeBuilder.prototype.addMeEndpoint = function() {
        this.params.url += '/me';
    };

    UserMeBuilder.prototype.addValidateEndpoint = function() {
        this.params.url += '/validate';
    };



    return oauth;
});
</code></pre>
        </article>
    </section>





        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Apr 04 2014 18:45:54 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>